<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Menu - Kusina ni Katya</title>

<script src="https://cdn.tailwindcss.com"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          accent: '#cda45e',
          'accent-light': '#e5b66a',
          'accent-dark': '#b8924e',
          dark: '#1a1a1a',
          'dark-light': '#2d2d2d',
          'light-bg': '#fef9f3',
          'cream': '#f5e9da',
        },
        fontFamily: {
          Inter: ['Inter', 'sans-serif'],
        },
        animation: {
          'fade-in': 'fadeIn 0.6s ease-out',
          'slide-up': 'slideUp 0.5s ease-out',
          'scale-in': 'scaleIn 0.4s ease-out',
        },
        keyframes: {
          fadeIn: {
            '0%': { opacity: '0' },
            '100%': { opacity: '1' },
          },
          slideUp: {
            '0%': { transform: 'translateY(30px)', opacity: '0' },
            '100%': { transform: 'translateY(0)', opacity: '1' },
          },
          scaleIn: {
            '0%': { transform: 'scale(0.9)', opacity: '0' },
            '100%': { transform: 'scale(1)', opacity: '1' },
          },
        },
      },
    },
  }
</script>

<style>
@font-face {
  font-family: 'Quiapo';
  src: url('assets/fonts/Quiapo_Free.ttf') format('opentype');
}

body {
  font-family: 'Inter', sans-serif;
}

.font-quiapo {
  font-family: 'Quiapo', 'Inter', sans-serif;
}

.smooth-scroll {
  scroll-behavior: smooth;
}

::-webkit-scrollbar {
  width: 10px;
}

::-webkit-scrollbar-track {
  background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
  background: #cda45e;
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: #b8924e;
}

.meal-card {
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.meal-card:hover {
  transform: translateY(-12px) scale(1.02);
}

.meal-card.hidden-item {
  display: none !important;
}

.pattern-bg {
  background-color: #fef9f3;
  background-image: 
    radial-gradient(circle at 25% 25%, rgba(205, 164, 94, 0.03) 0%, transparent 50%),
    radial-gradient(circle at 75% 75%, rgba(205, 164, 94, 0.03) 0%, transparent 50%);
}

.filter-btn.active {
  background: linear-gradient(135deg, #cda45e, #b8924e);
  color: white;
}

/* Cart Modal Styles */
#cart-modal.show {
  display: flex !important;
}

.cart-item {
  display: flex;
  gap: 1rem;
  padding: 1rem;
  border-radius: 1rem;
  background: #f9f9f9;
  margin-bottom: 1rem;
  transition: all 0.3s ease;
}

.cart-item:hover {
  background: #f0f0f0;
  transform: translateX(5px);
}

.cart-item-image {
  width: 80px;
  height: 80px;
  border-radius: 0.75rem;
  object-fit: cover;
}

.cart-item-details {
  flex: 1;
}

.cart-item-name {
  font-size: 1.125rem;
  font-weight: 600;
  color: #1a1a1a;
  margin-bottom: 0.25rem;
}

.cart-item-price {
  font-size: 1rem;
  color: #cda45e;
  font-weight: 600;
}

.cart-item-quantity {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-top: 0.5rem;
}

.quantity-btn {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: #cda45e;
  color: white;
  border: none;
  cursor: pointer;
  font-size: 1.25rem;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.quantity-btn:hover {
  background: #b8924e;
  transform: scale(1.1);
}

.quantity-display {
  font-weight: 600;
  min-width: 30px;
  text-align: center;
}

.remove-btn {
  background: #ef4444;
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 0.5rem;
  border: none;
  cursor: pointer;
  font-size: 0.875rem;
  font-weight: 600;
  transition: all 0.3s ease;
}

.remove-btn:hover {
  background: #dc2626;
  transform: scale(1.05);
}

.search-container {
  position: relative;
  max-width: 600px;
  margin: 0 auto;
}

.search-icon {
  position: absolute;
  left: 1rem;
  top: 50%;
  transform: translateY(-50%);
  color: #9ca3af;
}

#search-input {
  width: 100%;
  padding: 1rem 1rem 1rem 3rem;
  border: 2px solid #e5e7eb;
  border-radius: 9999px;
  font-size: 1rem;
  transition: all 0.3s ease;
}

#search-input:focus {
  outline: none;
  border-color: #cda45e;
  box-shadow: 0 0 0 3px rgba(205, 164, 94, 0.1);
}

.no-results {
  text-align: center;
  padding: 3rem;
  color: #6b7280;
  font-size: 1.125rem;
}

.glass-effect {
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
</style>
</head>

<body class="bg-light-bg pattern-bg text-dark smooth-scroll overflow-x-hidden">

<!-- HEADER / NAVIGATION -->
<header class="sticky top-0 z-50 glass-effect bg-white/80 shadow-md transition-all duration-300">
  <nav class="max-w-full mx-auto px-6 lg:px-12">
    <div class="flex justify-between items-center h-20">
      <!-- Logo - Far Left -->
      <div class="flex items-center space-x-3 animate-fade-in flex-shrink-0">
        <a href="index.html" class="flex items-center space-x-3">
          <img 
            src="assets/images/logo1.png" 
            alt="Kusina ni Katya Logo" 
            class="w-14 h-14 object-contain rounded-full shadow-lg"
          />
        </a>
        <div class="hidden sm:block">
          <h1 class="font-quiapo text-2xl font-bold text-accent tracking-widest">Kusina ni Katya</h1>
          <p class="text-xs text-gray-600">Authentic Filipino Cuisine</p>
        </div>
      </div>

<!-- Desktop Navigation - Far Right -->
<div class="hidden lg:flex items-center space-x-3">
  <a href="index.html" class="text-dark-light hover:text-accent font-medium transition-colors duration-300 text-[15px]">
    Home
  </a>
  <a href="menu.html" class="text-dark-light hover:text-accent font-medium transition-colors duration-300 text-[15px]">
    Menu
  </a>
  <a href="orders.html" class="text-dark-light hover:text-accent font-medium transition-colors duration-300 text-[15px]">
    Orders
  </a>
  <a href="contacts.html" class="text-dark-light hover:text-accent font-medium transition-colors duration-300 text-[15px]">
    Contact
  </a>
  
  <!-- Cart Button -->
  <a href="#" onclick="goToCart(); return false;" class="px-4 py-2 bg-gradient-to-r from-accent to-accent-dark text-white font-semibold rounded-full hover:shadow-lg hover:scale-105 transition-all duration-300 text-[13px]">
    üõí View Cart (<span id="cart-count">0</span>)
  </a>

  <!-- Auth Buttons - Hidden when logged in -->
  <div id="auth-buttons" class="flex items-center gap-2">
    <a href="login.html"
       class="px-5 py-2.5 bg-white border-2 border-accent text-accent font-semibold rounded-full hover:bg-accent hover:text-white hover:shadow-lg hover:scale-105 transition-all duration-300 text-[13px]">
      Log In
    </a>
    <a href="signup.html"
       class="px-5 py-2.5 bg-gradient-to-r from-accent to-accent-dark text-white font-semibold rounded-full hover:shadow-lg hover:scale-105 transition-all duration-300 text-[13px]">
      Sign Up
    </a>
  </div>

  <!-- User Profile - Shown when logged in -->
  <div id="user-profile" class="hidden items-center gap-2">
    <a href="profile.html" class="flex items-center space-x-2 px-3 py-2 bg-accent/10 rounded-full hover:bg-accent/20 transition-all duration-300 cursor-pointer">
      <div class="w-8 h-8 bg-accent rounded-full flex items-center justify-center">
        <span id="user-initial" class="text-white font-bold text-xs">U</span>
      </div>
      <span id="user-name" class="text-dark font-semibold text-[13px]">User</span>
    </a>
    <button onclick="logout()" class="px-5 py-2.5 bg-red-500 text-white font-semibold rounded-full hover:bg-red-600 hover:shadow-lg hover:scale-105 transition-all duration-300 text-[13px]">
      Logout
    </button>
  </div>
</div>

      <!-- Mobile Menu Button -->
      <button onclick="toggleMobileMenu()" class="lg:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors duration-300" id="mobile-menu-btn">
        <svg class="w-6 h-6 text-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden lg:hidden pb-6 animate-slide-up">
      <div class="flex flex-col space-y-3">
        <a href="index.html" class="text-dark-light hover:text-accent font-medium py-2 transition-colors duration-300"> Home</a>
        <a href="menu.html" class="text-dark-light hover:text-accent font-medium py-2 transition-colors duration-300"> Menu</a>
        <a href="orders.html" class="text-dark-light hover:text-accent font-medium py-2 transition-colors duration-300"> Orders</a>
        <button onclick="goToCart()" class="text-left text-dark-light hover:text-accent font-medium py-2 transition-colors duration-300">
          üõí View Cart (<span id="mobile-cart-count">0</span>)
        </button>
        <a href="#contact" class="text-dark-light hover:text-accent font-medium py-2 transition-colors duration-300"> Contact</a>
        
        <!-- Auth Buttons for Mobile - Hidden when logged in -->
        <div id="mobile-auth-buttons" class="flex flex-col space-y-3 pt-3 border-t border-gray-200">
          <a href="login.html" class="px-6 py-2.5 bg-gradient-to-r from-accent to-accent-dark text-white font-semibold rounded-full hover:shadow-lg hover:scale-105 transition-all duration-300 text-center">
            Log In
          </a>
          <a href="signup.html" class="px-6 py-2.5 border-2 border-accent text-accent font-semibold rounded-full hover:bg-accent hover:text-white hover:shadow-lg hover:scale-105 transition-all duration-300 text-center">
            Sign Up
          </a>
        </div>

        <!-- User Profile for Mobile - Shown when logged in -->
<div id="mobile-user-profile" class="hidden flex-col space-y-3 pt-3 border-t border-gray-200">
  <a href="profile.html" class="flex items-center space-x-3 px-4 py-2 bg-accent/10 rounded-full hover:bg-accent/20 transition-all duration-300">
    <div class="w-10 h-10 bg-accent rounded-full flex items-center justify-center">
      <span id="mobile-user-initial" class="text-white font-bold">U</span>
    </div>
    <span id="mobile-user-name" class="text-dark font-semibold">User</span>
  </a>
  <button onclick="logout()" class="px-6 py-2.5 bg-red-500 text-white font-semibold rounded-full hover:bg-red-600 hover:shadow-lg hover:scale-105 transition-all duration-300 text-center">
    Logout
  </button>
</div>
      </div>
    </div>
  </nav>
</header>

<section class="relative py-20 px-4 sm:px-6 lg:px-8 bg-gradient-to-br from-accent-dark/10 to-cream">
  <div class="max-w-7xl mx-auto text-center">
    <h1 class="font-quiapo text-5xl md:text-6xl font-bold text-dark mb-4 animate-slide-up">
     <span class="text-accent">Our Menu</span>
    </h1>
    <div class="w-32 h-1 bg-gradient-to-r from-accent-dark via-accent to-accent-light mx-auto rounded-full mb-6"></div>
    <p class="text-xl text-gray-700 max-w-3xl mx-auto animate-fade-in mb-8">
      Explore our delicious selection of authentic Filipino dishes, lovingly prepared with traditional recipes and fresh ingredients
    </p>
    
    <!-- Search Bar -->
    <div class="search-container mt-8">
      <svg class="search-icon w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
      <input 
        type="text" 
        id="search-input" 
        placeholder="Search for dishes... (e.g., Adobo, Sinigang, Desserts)"
        onkeyup="searchMenu()"
      />
    </div>
  </div>
</section>

<section class="py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">
    <div class="flex flex-wrap justify-center gap-3 mb-12">
      <button onclick="scrollToCategory('all', this)" class="filter-btn active px-6 py-3 rounded-full font-semibold transition-all duration-300 bg-gray-100 hover:bg-accent hover:text-white">
        All Items
      </button>
      <button onclick="scrollToCategory('main', this)" class="filter-btn px-6 py-3 rounded-full font-semibold transition-all duration-300 bg-gray-100 hover:bg-accent hover:text-white">
        Main Course
      </button>
      <button onclick="scrollToCategory('breakfast', this)" class="filter-btn px-6 py-3 rounded-full font-semibold transition-all duration-300 bg-gray-100 hover:bg-accent hover:text-white">
        Breakfast
      </button>
      <button onclick="scrollToCategory('dessert', this)" class="filter-btn px-6 py-3 rounded-full font-semibold transition-all duration-300 bg-gray-100 hover:bg-accent hover:text-white">
        Desserts
      </button>
      <button onclick="scrollToCategory('drink', this)" class="filter-btn px-6 py-3 rounded-full font-semibold transition-all duration-300 bg-gray-100 hover:bg-accent hover:text-white">
        Drinks
      </button>
    </div>

    <!-- No Results Message -->
    <div id="no-results" class="no-results hidden">
      <svg class="w-20 h-20 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <p class="text-xl font-semibold mb-2">No dishes found</p>
      <p>Try searching for something else or browse all categories</p>
    </div>

    <!-- Dynamic Menu Grid - Will be populated by JavaScript -->
    <div id="menu-container">
      <!-- Loading state -->
      <div id="loading-state" class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-16 w-16 border-b-4 border-accent mb-4"></div>
        <p class="text-xl text-gray-600">Loading delicious dishes...</p>
      </div>
    </div>
  </div>
</section>

<!-- FLOATING CART MODAL -->
<div id="cart-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
  <div class="bg-white rounded-3xl p-8 max-w-2xl w-full mx-4 shadow-2xl animate-scale-in max-h-[80vh] flex flex-col">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6 pb-4 border-b-2 border-accent/30">
      <h3 class="text-3xl font-bold text-dark">
        <span class="text-accent">Your Cart</span> üõí
      </h3>
      <button onclick="closeCartModal()" class="text-gray-500 hover:text-accent transition-colors duration-300">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Cart Items -->
    <div id="cart-items-container" class="flex-1 overflow-y-auto mb-6">
      <!-- Items will be inserted here -->
    </div>

    <!-- Cart Summary -->
    <div class="border-t-2 border-accent/30 pt-4">
      <div class="flex justify-between items-center mb-4">
        <span class="text-xl font-semibold text-dark">Subtotal:</span>
        <span id="cart-subtotal" class="text-2xl font-bold text-accent">‚Ç±0</span>
      </div>
      <div class="flex justify-between items-center mb-6">
        <span class="text-lg font-semibold text-dark">Total Items:</span>
        <span id="cart-total-items" class="text-xl font-bold text-dark">0</span>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-4">
        <button onclick="closeCartModal()" class="flex-1 px-6 py-3 border-2 border-accent text-accent font-semibold rounded-full hover:bg-accent/10 transition-all duration-300">
          Continue Shopping
        </button>
        <button onclick="proceedToCheckout()" class="flex-1 px-6 py-3 bg-gradient-to-r from-accent to-accent-dark text-white font-semibold rounded-full hover:shadow-lg hover:scale-105 transition-all duration-300">
          Proceed to Checkout ‚Üí
        </button>
      </div>
    </div>
  </div>
</div>

<footer class="bg-dark text-white py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
      <div class="col-span-1 md:col-span-2">
        <h3 class="font-quiapo text-3xl font-bold text-accent mb-3">Kusina ni Katya</h3>
        <p class="text-gray-400 mb-4">Bringing authentic Filipino home cooking to your table since 2020.</p>
      </div>

      <div>
        <h4 class="font-bold text-lg mb-4">Quick Links</h4>
        <ul class="space-y-2 text-gray-400">
          <li><a href="index.html" class="hover:text-accent transition-colors duration-300">Home</a></li>
          <li><a href="menu.html" class="hover:text-accent transition-colors duration-300">Menu</a></li>
          <li><a href="index.html#contact" class="hover:text-accent transition-colors duration-300">Contact</a></li>
        </ul>
      </div>

      <div>
        <h4 class="font-bold text-lg mb-4">Legal</h4>
        <ul class="space-y-2 text-gray-400">
          <li><a href="#" class="hover:text-accent transition-colors duration-300">Privacy Policy</a></li>
          <li><a href="#" class="hover:text-accent transition-colors duration-300">Terms of Service</a></li>
        </ul>
      </div>
    </div>

    <div class="border-t border-white/10 pt-8 text-center text-gray-400">
      <p>&copy; 2025 Kusina ni Katya. All Rights Reserved.</p>
    </div>
  </div>
</footer>

<script>
// ==================== GLOBAL STATE ====================
let allMenuItems = [];
let menuCart = [];

// ==================== STORE HOURS ====================
let storeHours = [];

/**
 * Load store hours from API
 */
async function loadStoreHours() {
  try {
    const API_URL = window.location.hostname === 'localhost' 
      ? 'http://localhost:3000/api' 
      : '/api';
    
    const response = await fetch(`${API_URL}/store-hours`);
    const data = await response.json();
    
    if (data.success && data.hours) {
      storeHours = data.hours;
      console.log('‚úÖ Store hours loaded:', storeHours);
    } else {
      console.warn('‚ö†Ô∏è Failed to load store hours, using default');
      // Fallback to default hours
      storeHours = [
        { day_of_week: 0, day_name: 'Sunday', is_open: false, open_time: null, close_time: null },
        { day_of_week: 1, day_name: 'Monday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' },
        { day_of_week: 2, day_name: 'Tuesday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' },
        { day_of_week: 3, day_name: 'Wednesday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' },
        { day_of_week: 4, day_name: 'Thursday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' },
        { day_of_week: 5, day_name: 'Friday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' },
        { day_of_week: 6, day_name: 'Saturday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' }
      ];
    }
  } catch (error) {
    console.error('‚ùå Error loading store hours:', error);
    // Fallback to default hours
    storeHours = [
      { day_of_week: 0, day_name: 'Sunday', is_open: false, open_time: null, close_time: null },
      { day_of_week: 1, day_name: 'Monday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' },
      { day_of_week: 2, day_name: 'Tuesday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' },
      { day_of_week: 3, day_name: 'Wednesday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' },
      { day_of_week: 4, day_name: 'Thursday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' },
      { day_of_week: 5, day_name: 'Friday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' },
      { day_of_week: 6, day_name: 'Saturday', is_open: true, open_time: '11:00:00', close_time: '15:00:00' }
    ];
  }
}

/**
 * Check if store is currently open based on store hours from API
 */
function isStoreOpen() {
  if (storeHours.length === 0) {
    // If hours not loaded yet, use fallback
    const now = new Date();
    const hours = now.getHours();
    const day = now.getDay();
    return day >= 1 && day <= 6 && hours >= 11 && hours < 15;
  }
  
  const now = new Date();
  const currentDay = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
  const currentHour = now.getHours();
  const currentMinute = now.getMinutes();
  const currentTime = currentHour * 60 + currentMinute; // Convert to minutes for easier comparison
  
  // Find today's hours
  const todayHours = storeHours.find(h => h.day_of_week === currentDay);
  
  if (!todayHours || !todayHours.is_open) {
    return false; // Store is closed today
  }
  
  // Parse open and close times
  if (!todayHours.open_time || !todayHours.close_time) {
    return false; // No times set
  }
  
  const [openHour, openMin = 0] = todayHours.open_time.split(':').map(Number);
  const [closeHour, closeMin = 0] = todayHours.close_time.split(':').map(Number);
  
  const openTime = openHour * 60 + (openMin || 0);
  const closeTime = closeHour * 60 + (closeMin || 0);
  
  // Check if current time is within open hours
  return currentTime >= openTime && currentTime < closeTime;
}

// ==================== TOAST NOTIFICATIONS ====================
function showToast(message, type = 'info') {
  try {
    const id = 'global-toast';
    const existing = document.getElementById(id);
    if (existing) existing.remove();
    const colors = {
      success: 'bg-green-600',
      error: 'bg-red-600',
      info: 'bg-accent'
    };
    const div = document.createElement('div');
    div.id = id;
    div.className = `fixed bottom-6 right-6 z-50 text-white px-4 py-3 rounded-xl shadow-2xl ${colors[type] || colors.info}`;
    div.textContent = message;
    document.body.appendChild(div);
    setTimeout(() => div.remove(), 2500);
  } catch {}
}

// ==================== AUTH & USER MANAGEMENT ====================
function getCurrentUser() {
  try {
    const userStr = localStorage.getItem('currentUser');
    if (!userStr || userStr === 'null' || userStr === 'undefined') return null;
    const user = JSON.parse(userStr);
    if (!user || !user.email) return null;
    return user;
  } catch (e) {
    return null;
  }
}

function getCartKey() {
  const user = getCurrentUser();
  return user && user.email ? `kusinaCart_${user.email}` : 'kusinaCart_guest';
}

function checkLoginStatus() {
  const user = getCurrentUser();
  const isLoggedIn = !!(user && user.email);
  
  const authButtons = document.getElementById('auth-buttons');
  const userProfile = document.getElementById('user-profile');
  const userName = document.getElementById('user-name');
  const userInitial = document.getElementById('user-initial');
  
  const mobileAuthButtons = document.getElementById('mobile-auth-buttons');
  const mobileUserProfile = document.getElementById('mobile-user-profile');
  const mobileUserName = document.getElementById('mobile-user-name');
  const mobileUserInitial = document.getElementById('mobile-user-initial');
  
  if (isLoggedIn) {
    if (authButtons) authButtons.classList.add('hidden');
    if (userProfile) {
      userProfile.classList.remove('hidden');
      userProfile.classList.add('flex');
    }
    if (userName) userName.textContent = user.name || user.email;
    if (userInitial) userInitial.textContent = (user.name || user.email).charAt(0).toUpperCase();
    
    if (mobileAuthButtons) mobileAuthButtons.classList.add('hidden');
    if (mobileUserProfile) {
      mobileUserProfile.classList.remove('hidden');
      mobileUserProfile.classList.add('flex');
    }
    if (mobileUserName) mobileUserName.textContent = user.name || user.email;
    if (mobileUserInitial) mobileUserInitial.textContent = (user.name || user.email).charAt(0).toUpperCase();
  } else {
    if (authButtons) authButtons.classList.remove('hidden');
    if (userProfile) {
      userProfile.classList.add('hidden');
      userProfile.classList.remove('flex');
    }
    
    if (mobileAuthButtons) mobileAuthButtons.classList.remove('hidden');
    if (mobileUserProfile) {
      mobileUserProfile.classList.add('hidden');
      mobileUserProfile.classList.remove('flex');
    }
  }
}

function logout() {
  if (confirm('Are you sure you want to logout?')) {
    const cartKey = getCartKey();
    localStorage.removeItem(cartKey);
    localStorage.removeItem('currentUser');
    sessionStorage.removeItem('authToken');
    localStorage.removeItem('authToken');
    
    checkLoginStatus();
    showToast('‚úÖ You have been logged out successfully!', 'success');
    
    setTimeout(() => {
      window.location.href = 'index.html';
    }, 500);
  }
}

// ==================== CART MANAGEMENT ====================
function loadCart() {
  const cartKey = getCartKey();
  const savedCart = localStorage.getItem(cartKey);
  if (savedCart) {
    menuCart = JSON.parse(savedCart);
  } else {
    menuCart = [];
  }
  updateCartCount();
}

function saveCart() {
  const cartKey = getCartKey();
  if (menuCart.length === 0) {
    localStorage.removeItem(cartKey);
  } else {
    localStorage.setItem(cartKey, JSON.stringify(menuCart));
  }
}

function updateCartCount() {
  const count = menuCart.reduce((sum, item) => sum + (item.quantity || 0), 0);
  const cartCountEl = document.getElementById('cart-count');
  const mobileCartCountEl = document.getElementById('mobile-cart-count');
  if (cartCountEl) cartCountEl.textContent = count;
  if (mobileCartCountEl) mobileCartCountEl.textContent = count;
}

function addToCart(button, mealName, mealPrice, mealImage) {
  if (!isStoreOpen()) {
    showToast("We're closed right now. Please come back during opening hours.", 'info');
    return;
  }
  const existingItem = menuCart.find(item => item.name === mealName);
  
  if (existingItem) {
    existingItem.quantity++;
  } else {
    menuCart.push({
      id: Date.now(),
      name: mealName,
      price: mealPrice,
      quantity: 1,
      image: mealImage
    });
  }
  
  saveCart();
  
  const originalText = button.textContent;
  button.textContent = 'Added!';
  button.classList.add('bg-green-600');
  setTimeout(() => {
    button.textContent = originalText;
    button.classList.remove('bg-green-600');
  }, 1000);
  
  updateCartCount();
}

function goToCart() {
  if (menuCart.length === 0) {
    showToast('Your cart is empty!', 'info');
    return;
  } 
  
  displayCartModal();
}

function displayCartModal() {
  const modal = document.getElementById('cart-modal');
  const container = document.getElementById('cart-items-container');
  const subtotalEl = document.getElementById('cart-subtotal');
  const totalItemsEl = document.getElementById('cart-total-items');
  
  if (!modal || !container) return;
  
  modal.classList.remove('hidden');
  modal.classList.add('show');
  
  if (menuCart.length === 0) {
    container.innerHTML = '<p class="text-center text-gray-500 py-8">Your cart is empty</p>';
    if (subtotalEl) subtotalEl.textContent = '‚Ç±0';
    if (totalItemsEl) totalItemsEl.textContent = '0';
    return;
  }
  
  container.innerHTML = menuCart.map((item, index) => {
    const total = parseFloat(item.price || 0) * (item.quantity || 1);
    return `
      <div class="cart-item">
        <img src="${escapeHtml(item.image || 'assets/images/placeholder.jpg')}" 
             alt="${escapeHtml(item.name)}" 
             class="cart-item-image"
             onerror="this.src='assets/images/placeholder.jpg'">
        <div class="cart-item-details">
          <h4 class="cart-item-name">${escapeHtml(item.name)}</h4>
          <p class="cart-item-price">‚Ç±${parseFloat(item.price || 0).toFixed(2)}</p>
          <div class="cart-item-quantity">
            <button onclick="updateQuantity(${index}, -1)" class="quantity-btn">-</button>
            <span class="quantity-display">${item.quantity || 1}</span>
            <button onclick="updateQuantity(${index}, 1)" class="quantity-btn">+</button>
            <button onclick="removeFromCart(${index})" class="remove-btn ml-auto">Remove</button>
          </div>
        </div>
      </div>
    `;
  }).join('');
  
  const subtotal = menuCart.reduce((sum, item) => sum + (parseFloat(item.price || 0) * (item.quantity || 1)), 0);
  const totalItems = menuCart.reduce((sum, item) => sum + (item.quantity || 0), 0);
  
  if (subtotalEl) subtotalEl.textContent = `‚Ç±${subtotal.toFixed(2)}`;
  if (totalItemsEl) totalItemsEl.textContent = totalItems;
}

function updateQuantity(index, change) {
  if (menuCart[index]) {
    menuCart[index].quantity += change;
    
    if (menuCart[index].quantity <= 0) {
      menuCart.splice(index, 1);
    }
    
    updateCartCount();
    saveCart();
    
    if (menuCart.length > 0) {
      displayCartModal();
    } else {
      closeCartModal();
      showToast('Your cart is now empty!', 'info');
    }
  }
}

function removeFromCart(index) {
  if (confirm('Remove this item from cart?')) {
    menuCart.splice(index, 1);
    saveCart();
    updateCartCount();
    
    if (menuCart.length > 0) {
      displayCartModal();
    } else {
      closeCartModal();
      showToast('Your cart is now empty!', 'info');
    }
  }
}

function closeCartModal() {
  const modal = document.getElementById('cart-modal');
  if (modal) {
    modal.classList.remove('show');
    modal.classList.add('hidden');
  }
}

function proceedToCheckout() {
  if (menuCart.length === 0) {
    showToast('Your cart is empty!', 'info');
    return;
  }
  
  const cartParam = encodeURIComponent(JSON.stringify(menuCart));
  window.location.href = `cart.html?cart=${cartParam}`;
}

// ==================== MENU FETCHING & RENDERING ====================
async function fetchMenu() {
  try {
    const loadingState = document.getElementById('loading-state');
    const container = document.getElementById('menu-container');
    const noResults = document.getElementById('no-results');
    
    console.log('üì° Fetching menu from API...');
    
    const res = await fetch('/api/menu');
    
    if (!res.ok) {
      throw new Error('Failed to fetch menu');
    }
    
    const data = await res.json();
    allMenuItems = data.items || [];
    
    console.log('‚úÖ Menu loaded:', allMenuItems.length, 'items');
    
    if (loadingState) loadingState.classList.add('hidden');
    if (noResults) noResults.classList.add('hidden');
    
    renderMenuByCategories();
    
  } catch (err) {
    console.error('‚ùå Menu fetch error:', err);
    const loadingState = document.getElementById('loading-state');
    const container = document.getElementById('menu-container');
    
    if (loadingState) loadingState.classList.add('hidden');
    
    if (container) {
      container.innerHTML = `
        <div class="text-center py-12">
          <svg class="w-20 h-20 mx-auto mb-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <p class="text-xl font-semibold text-gray-700 mb-2">Failed to load menu</p>
          <p class="text-gray-500 mb-4">Please refresh the page or try again later</p>
          <button onclick="fetchMenu()" class="px-6 py-2 bg-accent text-white rounded-full hover:bg-accent-dark transition-colors">
            Retry
          </button>
        </div>
      `;
    }
  }
}

function renderMenuByCategories() {
  const container = document.getElementById('menu-container');
  if (!container) return;
  
  const categories = {
    'all': 'All Items',
    'main': 'Main Course',
    'breakfast': 'Breakfast',
    'dessert': 'Desserts',
    'drink': 'Drinks'
  };
  
  let html = '';
  
  Object.keys(categories).forEach(category => {
    let items = allMenuItems;
    
    if (category !== 'all') {
      items = allMenuItems.filter(item => {
        const itemCategory = (item.category || '').toLowerCase();
        return itemCategory === category || itemCategory === category + 's';
      });
    }
    
    if (items.length === 0 && category === 'all') {
      html = '<div class="text-center py-12"><p class="text-gray-500">No menu items available</p></div>';
      container.innerHTML = html;
      return;
    }
    
    if (items.length > 0) {
      html += `
        <div class="mb-16" id="category-${category}">
          <h2 class="font-quiapo text-4xl font-bold text-dark mb-6 text-center">
            <span class="text-accent">${categories[category]}</span>
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            ${items.map(item => createMenuCard(item)).join('')}
          </div>
        </div>
      `;
    }
  });
  
  container.innerHTML = html;
}

function createMenuCard(item) {
  const imageUrl = item.image_url || 'assets/images/placeholder.jpg';
  const badge = item.badge ? `<span class="absolute top-4 right-4 bg-accent text-white px-3 py-1 rounded-full text-xs font-bold">${escapeHtml(item.badge)}</span>` : '';
  const featured = item.is_featured ? '<span class="absolute top-4 left-4 bg-yellow-400 text-dark px-3 py-1 rounded-full text-xs font-bold">‚≠ê Featured</span>' : '';
  
  return `
    <div class="meal-card bg-white rounded-2xl overflow-hidden shadow-lg group">
      <div class="relative overflow-hidden h-64">
        <img src="${escapeHtml(imageUrl)}" 
             alt="${escapeHtml(item.name)}" 
             class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
             onerror="this.src='assets/images/placeholder.jpg'">
        ${badge}
        ${featured}
      </div>
      <div class="p-6 flex flex-col">
        <h3 class="text-2xl font-bold text-dark mb-2 group-hover:text-accent transition-colors duration-300">
          ${escapeHtml(item.name)}
        </h3>
        <p class="text-gray-600 mb-4 line-clamp-2">
          ${escapeHtml(item.description || 'Delicious Filipino dish')}
        </p>
        <div class="flex-1"></div>
        <div class="flex items-center justify-between">
          <span class="text-accent font-bold text-xl">‚Ç±${parseFloat(item.price || 0).toFixed(2)}</span>
          <button 
            onclick="addToCart(this, '${escapeJs(item.name)}', ${item.price}, '${escapeJs(item.image_url || '')}')" 
            class="px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent-dark transition-colors duration-300 text-sm font-semibold">
            Add to Cart
          </button>
        </div>
      </div>
    </div>
  `;
}

// ==================== SEARCH & FILTER ====================
function searchMenu() {
  const searchInput = document.getElementById('search-input');
  const searchTerm = (searchInput?.value || '').toLowerCase().trim();
  const container = document.getElementById('menu-container');
  const noResults = document.getElementById('no-results');
  
  if (!container) return;
  
  if (!searchTerm) {
    renderMenuByCategories();
    if (noResults) noResults.classList.add('hidden');
    return;
  }
  
  const filtered = allMenuItems.filter(item => {
    const name = (item.name || '').toLowerCase();
    const description = (item.description || '').toLowerCase();
    const category = (item.category || '').toLowerCase();
    return name.includes(searchTerm) || description.includes(searchTerm) || category.includes(searchTerm);
  });
  
  if (filtered.length === 0) {
    container.innerHTML = '';
    if (noResults) noResults.classList.remove('hidden');
    return;
  }
  
  if (noResults) noResults.classList.add('hidden');
  
  container.innerHTML = `
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      ${filtered.map(item => createMenuCard(item)).join('')}
    </div>
  `;
}

function scrollToCategory(category, button) {
  const categoryEl = document.getElementById(`category-${category}`);
  
  if (category === 'all') {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  } else if (categoryEl) {
    categoryEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
  
  // Update active filter button
  document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
  if (button) button.classList.add('active');
}

// ==================== NAVIGATION ====================
function toggleMobileMenu() {
  const menu = document.getElementById('mobile-menu');
  if (menu) menu.classList.toggle('hidden');
}

// ==================== UTILITY FUNCTIONS ====================
function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text || '';
  return div.innerHTML;
}

function escapeJs(str) {
  return (str || '').replace(/'/g, "\\'").replace(/"/g, '\\"').replace(/\n/g, '\\n').replace(/\r/g, '\\r');
}

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', function() {
  console.log('üöÄ Menu page initializing...');
  
  // Load store hours first (needed for isStoreOpen checks)
  loadStoreHours();
  
  checkLoginStatus();
  loadCart();
  fetchMenu();
  
  // Close modal when clicking outside
  document.addEventListener('click', function(event) {
    const modal = document.getElementById('cart-modal');
    if (event.target === modal) {
      closeCartModal();
    }
  });
  
  console.log('‚úÖ Menu page initialized');
});
</script>

</body>
</html>